<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Lanchonete</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./../../Raiz/CSS/style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-info">
        <span class="material-symbols-outlined text-white">fastfood</span>
        <p class="h2 font-weight-bold ml-2 mb-0 text-white">Lanchonete</p>
        <button class="navbar-toggler custom-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="./../../Frontend/Views/index.html">
                        <span class="material-symbols-outlined">home</span> Início
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./../../Frontend/Views/produtos.html">
                        <span class="material-symbols-outlined">lunch_dining</span> Produtos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./../../Frontend/Views/estoque.html">
                        <span class="material-symbols-outlined">inventory_2</span> Estoque
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./../../Frontend/Views/vendas.html">
                        <span class="material-symbols-outlined">point_of_sale</span> Vendas
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./../../Frontend/Views/compras.html">
                        <span class="material-symbols-outlined">shopping_cart</span> Compras
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./../../Frontend/Views/relatorios.html">
                        <span class="material-symbols-outlined">lab_profile</span> Relatórios
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="material-symbols-outlined">account_circle</span> 
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="./../../Backend/Controllers/perfil_usuario.php">
                            <span class="material-symbols-outlined">badge</span> Perfil
                        </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="./../../Backend/Controllers/logout.php">
                            <span class="material-symbols-outlined">logout</span> Sair
                        </a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <div id="alert-container"></div>

    <div class="container mt-5">
        <div class="jumbotron text-center">
            <h2 class="display-4">Lista de Produtos</h2>
            <button class="btn btn-success mb-3" data-toggle="modal" data-target="#addProductModal">Adicionar Produto</button>
            <div class="row" id="productsContainer">
               
            </div>
        </div>
    </div>

    <footer class="text-center text-white bg-info mt-auto py-3">
        <div class="container">
            © 2024 Lanchonete Copyright
        </div>
    </footer>


   
    <div class="modal fade" id="productDetailsModal" tabindex="-1" role="dialog" aria-labelledby="productDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productDetailsModalLabel">Detalhes do Produto</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="productDetailsContent">
                    
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

   
    <div class="modal fade" id="editProductModal" tabindex="-1" role="dialog" aria-labelledby="editProductModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductModalLabel">Editar Produto</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                   
                    <form id="editProductForm">
                        <input type="hidden" id="editProductId" name="id">
                        <div class="form-group">
                            <label for="editNome">Nome do Produto</label>
                            <input type="text" class="form-control" id="editNome" name="nome" required>
                        </div>
                        <div class="form-group">
                            <label for="editValor">Valor do Produto</label>
                            <input type="number" class="form-control" id="editValor" name="valor" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="editDataFabricacao">Data de Fabricação</label>
                            <input type="date" class="form-control" id="editDataFabricacao" name="data_fabricacao" required>
                        </div>
                        <div class="form-group">
                            <label for="editDataValidade">Data de Validade</label>
                            <input type="date" class="form-control" id="editDataValidade" name="data_validade" required>
                        </div>
                        <div class="form-group">
                            <label for="editEstoqueMinimo">Estoque Mínimo</label>
                            <input type="number" class="form-control" id="editEstoqueMinimo" name="estoque_minimo" required>
                        </div>
                        <div class="form-group">
                            <label for="editEstoqueMaximo">Estoque Máximo</label>
                            <input type="number" class="form-control" id="editEstoqueMaximo" name="estoque_maximo" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveChangesBtn">Salvar Alterações</button>
                </div>
            </div>
        </div>
    </div>

    
    <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addProductModalLabel">Adicionar Produto</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                
                <form id="addProductForm" enctype="multipart/form-data">
                   
                    <div class="form-group">
                        <label for="addNome">Nome do Produto</label>
                        <input type="text" class="form-control" id="addNome" name="nome" required>
                    </div>
                    <div class="form-group">
                        <label for="addValor">Valor do Produto</label>
                        <input type="number" class="form-control" id="addValor" name="valor" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="addDataFabricacao">Data de Fabricação</label>
                        <input type="date" class="form-control" id="addDataFabricacao" name="data_fabricacao" required>
                    </div>
                    <div class="form-group">
                        <label for="addDataValidade">Data de Validade</label>
                        <input type="date" class="form-control" id="addDataValidade" name="data_validade" required>
                    </div>
                    <div class="form-group">
                        <label for="addEstoqueMinimo">Estoque Mínimo</label>
                        <input type="number" class="form-control" id="addEstoqueMinimo" name="estoque_minimo" required>
                    </div>
                    <div class="form-group">
                        <label for="addEstoqueMaximo">Estoque Máximo</label>
                        <input type="number" class="form-control" id="addEstoqueMaximo" name="estoque_maximo" required>
                    </div>
                    <div class="form-group">
                        <label for="addImagem">Imagem do Produto</label>
                        <input type="file" class="form-control-file" id="addImagem" name="imagens">
                    </div>
                </form>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveProductBtn">Salvar Produto</button>
            </div>
        </div>
    </div>
    </div>

    

    <script>
        document.addEventListener('DOMContentLoaded', function () {
    
        loadProducts();

        document.getElementById('saveChangesBtn').addEventListener('click', function () {
            const editProductForm = document.getElementById('editProductForm');
            const formData = new FormData(editProductForm);

            fetch('./../../Backend/Controllers/editar_produto.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('success', data.success); 
                    $('#editProductModal').modal('hide'); 
                    loadProducts(); 
                } else if (data.error) {
                    showAlert('error', data.error); 
                }
            })
            .catch(error => console.error('Erro ao salvar alterações:', error));
        });

        $('#openAddProductModalBtn').on('click', function() {
            $('#addProductModal').modal('show');
        });

        $('#saveProductBtn').on('click', function() {
            const addProductForm = document.getElementById('addProductForm');
            const formData = new FormData(addProductForm);

            fetch('./../../Backend/Controllers/adicionar_produto.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('success', data.success); 
                    $('#addProductModal').modal('hide'); 
                    loadProducts(); 
                } else if (data.error) {
                    showAlert('error', data.error); 
                }
            })
            .catch(error => console.error('Erro ao adicionar produto:', error));
        });

        function showAlert(type, message) {
            let alertDiv = document.getElementById(type === 'success' ? 'successMessage' : 'errorMessage');
            let alertText = document.getElementById(type === 'success' ? 'successMessageText' : 'errorMessageText');

            if (!alertDiv) {
                alertDiv = document.createElement('div');
                alertDiv.id = type === 'success' ? 'successMessage' : 'errorMessage';
                alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show`;
                alertDiv.role = 'alert';

                alertText = document.createElement('span');
                alertText.id = type === 'success' ? 'successMessageText' : 'errorMessageText';
                alertDiv.appendChild(alertText);

                const closeButton = document.createElement('button');
                closeButton.type = 'button';
                closeButton.className = 'close';
                closeButton.setAttribute('data-dismiss', 'alert');
                closeButton.setAttribute('aria-label', 'Close');
                closeButton.innerHTML = '<span aria-hidden="true">&times;</span>';
                alertDiv.appendChild(closeButton);

                document.getElementById('alert-container').appendChild(alertDiv);
            }

            alertText.textContent = message; 
            alertDiv.classList.remove('d-none'); 

            setTimeout(() => {
                alertDiv.classList.add('d-none'); 
            }, 3500); 
        }

       
        function loadProducts() {
            fetch('./../../Backend/Controllers/obter_produtos_lista.php')
                .then(response => response.json())
                .then(data => {
                    const productsContainer = document.getElementById('productsContainer');
                    productsContainer.innerHTML = ''; 

                    data.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.classList.add('col-lg-6', 'mb-4', 'product-card');

                        productCard.innerHTML = `
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">${product.nome}</h5>
                                    <p class="card-text"><strong>Valor:</strong> R$ ${parseFloat(product.valor).toFixed(2)}</p>
                                    <p class="card-text"><strong>Validade:</strong> ${product.data_validade}</p>
                                    <button class="btn btn-primary btn-sm mr-2 view-details" data-id="${product.id_produto}">Ver Detalhes</button>
                                    <button class="btn btn-danger btn-sm remove-product" data-id="${product.id_produto}">Remover</button>
                                    <button class="btn btn-secondary btn-sm edit-product" data-id="${product.id_produto}">Editar</button>
                                </div>
                                <div class="product-details d-none" id="details-${product.id_produto}">
                                    <p><strong>Fabricação:</strong> ${product.data_fabricacao}</p>
                                    <p><strong>Estoque Mínimo:</strong> ${product.estoque_minimo}</p>
                                    <p><strong>Estoque Máximo:</strong> ${product.estoque_maximo}</p>
                                </div>
                            </div>
                        `;

                        productsContainer.appendChild(productCard);

                        productCard.querySelector('.view-details').addEventListener('click', function () {
                            const productId = this.getAttribute('data-id');
                            const productDetails = document.getElementById(`details-${productId}`);
                            document.getElementById('productDetailsContent').innerHTML = productDetails.innerHTML;
                            $('#productDetailsModal').modal('show');
                        });

                        productCard.querySelector('.remove-product').addEventListener('click', function () {
                            const productId = this.getAttribute('data-id');
                            if (confirm('Tem certeza que deseja remover este produto?')) {
                                fetch('./../../Backend/Controllers/remover_produto.php', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/x-www-form-urlencoded',
                                    },
                                    body: `produto_id=${productId}`,
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            showAlert('success', data.success); 
                                            loadProducts(); 
                                        } else {
                                            showAlert('error', data.error); 
                                        }
                                    })
                                    .catch(error => console.error('Erro ao remover produto:', error));
                            }
                        });

                        productCard.querySelector('.edit-product').addEventListener('click', function () {
                            const productId = this.getAttribute('data-id');
                            fetch(`./../../Backend/Controllers/obter_produtos_lista.php?id=${productId}`)
                                .then(response => response.json())
                                .then(data => {
                                
                                    document.getElementById('editProductId').value = data.id_produto;
                                    document.getElementById('editNome').value = data.nome;
                                    document.getElementById('editValor').value = data.valor;
                                    document.getElementById('editDataFabricacao').value = data.data_fabricacao;
                                    document.getElementById('editDataValidade').value = data.data_validade;
                                    document.getElementById('editEstoqueMinimo').value = data.estoque_minimo;
                                    document.getElementById('editEstoqueMaximo').value = data.estoque_maximo;

                                    
                                    $('#editProductModal').modal('show');
                                })
                                .catch(error => console.error('Erro ao carregar dados do produto para edição:', error));
                        });
                    });
                })
                .catch(error => console.error('Erro ao carregar produtos:', error));
        }
    });

    </script>


    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>